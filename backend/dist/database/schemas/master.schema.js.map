{"version":3,"sources":["../../../src/database/schemas/master.schema.ts"],"sourcesContent":["import {\r\n  pgTable,\r\n  varchar,\r\n  text,\r\n  boolean,\r\n  timestamp,\r\n  integer,\r\n  date,\r\n  time,\r\n  index,\r\n  uniqueIndex,\r\n  uuid,\r\n} from \"drizzle-orm/pg-core\";\r\nimport { relations } from \"drizzle-orm\";\r\nimport { queueCalls, queues } from \"./queue.schema\";\r\nimport { timestamps } from \"../helpers/timestamps\";\r\nimport { gender } from \"../helpers/enums\";\r\n\r\n// ========================================\r\n// MODUL MASTER DATA\r\n// ========================================\r\n\r\nexport const staff = pgTable(\r\n  \"staff\",\r\n  {\r\n    id: uuid().defaultRandom().primaryKey(),\r\n    clinicId: uuid(\"clinic_id\").references(() => clinics.id, {\r\n      onDelete: \"set null\",\r\n    }),\r\n    code: varchar(\"code\").notNull().unique(),\r\n    loketNumber: varchar(\"loket_number\").notNull(),\r\n    nik: varchar().unique(),\r\n    name: varchar(\"name\").notNull(),\r\n    username: varchar(\"username\").notNull().unique(),\r\n    email: varchar(\"email\").notNull().unique(),\r\n    password: varchar(\"password_hash\").notNull(),\r\n    phone: varchar().notNull(),\r\n    address: text(),\r\n    lastLoginAt: timestamp(\"last_login_at\"),\r\n    isActive: boolean(\"is_active\").default(true).notNull(),\r\n    ...timestamps,\r\n  },\r\n  (table) => [\r\n    index(\"staff_clinic_idx\").on(table.clinicId),\r\n    index(\"staff_code_idx\").on(table.code),\r\n    index(\"staff_active_idx\").on(table.isActive),\r\n  ]\r\n);\r\n\r\nexport type StaffsSchema = typeof staff.$inferSelect; // return type when queried\r\nexport type NewStaff = typeof staff.$inferInsert; // insert type\r\n\r\nexport const patients = pgTable(\r\n  \"patients\",\r\n  {\r\n    id: uuid().defaultRandom().primaryKey(),\r\n    code: varchar(\"code\").notNull().unique(),\r\n    registrationNumber: varchar(\"registration_number\").notNull().unique(),\r\n    nik: varchar(\"nik\").unique().notNull(),\r\n    name: varchar(\"name\").notNull(),\r\n    birthDate: date(\"birth_date\", { mode: \"date\" }).notNull(),\r\n    gender: gender(\"gender\").notNull(),\r\n    phone: varchar(\"phone\").notNull(),\r\n    address: text(\"address\").notNull(),\r\n    patientType: varchar(\"patient_type\").notNull(),\r\n    patientClass: varchar(\"patient_class\").notNull(),\r\n    haveAssurance: boolean(\"have_assurance\").notNull(),\r\n    assuranceCode: varchar(\"assuranceCode\").unique(),\r\n    ...timestamps,\r\n  },\r\n  (table) => [\r\n    uniqueIndex(\"patients_nik_idx\").on(table.nik),\r\n    index(\"patients_reg_number_idx\").on(table.registrationNumber),\r\n  ]\r\n);\r\n\r\nexport type PatientsSchema = typeof patients.$inferSelect; // return type when queried\r\nexport type NewPatient = typeof patients.$inferInsert; // insert type\r\n\r\nexport const doctors = pgTable(\r\n  \"doctors\",\r\n  {\r\n    id: uuid().defaultRandom().primaryKey(),\r\n    code: varchar(\"code\").notNull().unique(),\r\n    name: varchar(\"name\").notNull(),\r\n    specialization: varchar(\"specialization\"),\r\n    phone: varchar(\"phone\"),\r\n    dayOfWeek: integer(\"day_of_week\").notNull(), // 1=Monday, 7=Sunday\r\n    startTime: time(\"start_time\").notNull(),\r\n    endTime: time(\"end_time\").notNull(),\r\n    quota: integer(\"quota\").default(30).notNull(),\r\n    isActive: boolean(\"is_active\").default(true).notNull(),\r\n    ...timestamps,\r\n  },\r\n  (table) => [\r\n    index(\"doctors_code_idx\").on(table.code),\r\n    index(\"doctors_active_idx\").on(table.isActive),\r\n  ]\r\n);\r\n\r\nexport type DoctorsSchema = typeof doctors.$inferSelect; // return type when queried\r\nexport type NewDoctor = typeof doctors.$inferInsert; // insert type\r\n\r\nexport const clinics = pgTable(\r\n  \"clinics\",\r\n  {\r\n    id: uuid().defaultRandom().primaryKey(),\r\n    code: varchar(\"code\").notNull().unique(),\r\n    name: varchar(\"name\").notNull(),\r\n    description: text(\"description\"),\r\n    isActive: boolean(\"is_active\").default(true).notNull(),\r\n    ...timestamps,\r\n  },\r\n  (table) => [\r\n    index(\"clinics_code_idx\").on(table.code),\r\n    index(\"clinics_active_idx\").on(table.isActive),\r\n  ]\r\n);\r\n\r\nexport type ClinicsSchema = typeof clinics.$inferSelect; // return type when queried\r\nexport type NewClinic = typeof clinics.$inferInsert; // insert type\r\n\r\n// ========================================\r\n// RELATIONS\r\n// ========================================\r\n\r\nexport const staffRelations = relations(staff, ({ one, many }) => ({\r\n  clinics: one(clinics, {\r\n    fields: [staff.clinicId],\r\n    references: [clinics.id],\r\n  }),\r\n  queues: many(queues),\r\n  queueCalls: many(queueCalls),\r\n}));\r\n\r\nexport const patientsRelations = relations(patients, ({ many }) => ({\r\n  queues: many(queues),\r\n}));\r\n\r\nexport const doctorsRelations = relations(doctors, ({ many }) => ({\r\n  queues: many(queues),\r\n}));\r\n\r\nexport const clinicRelations = relations(clinics, ({ many }) => ({\r\n  staff: many(staff),\r\n  doctor: many(doctors),\r\n  queues: many(queues),\r\n}));\r\n"],"names":["clinicRelations","clinics","doctors","doctorsRelations","patients","patientsRelations","staff","staffRelations","pgTable","id","uuid","defaultRandom","primaryKey","clinicId","references","onDelete","code","varchar","notNull","unique","loketNumber","nik","name","username","email","password","phone","address","text","lastLoginAt","timestamp","isActive","boolean","default","timestamps","table","index","on","registrationNumber","birthDate","date","mode","gender","patientType","patientClass","haveAssurance","assuranceCode","uniqueIndex","specialization","dayOfWeek","integer","startTime","time","endTime","quota","description","relations","one","many","fields","queues","queueCalls","doctor"],"mappings":"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"}