{"version":3,"sources":["../../src/database/seeder.ts"],"sourcesContent":["import { drizzle } from \"drizzle-orm/node-postgres\";\r\nimport {\r\n  clinics,\r\n  doctors,\r\n  NewClinic,\r\n  NewDoctor,\r\n  NewPatient,\r\n  NewStaff,\r\n  patients,\r\n  staff,\r\n} from \"./schemas/master.schema\";\r\nimport { generateCode } from \"src/utils/generate-code\";\r\nimport { encryptPassword } from \"src/utils/encrypt\";\r\nimport { PatientClass } from \"src/modules/master/utils/patient-class.enum\";\r\nimport { PatientType } from \"src/modules/master/utils/patient-type.enum\";\r\nimport { Gender } from \"src/modules/master/utils/gender.enum\";\r\n\r\nasync function seedDatabase() {\r\n  console.log(\"Loading environment variables...\");\r\n  const dbConnectionString = process.env.DB_CONNECTION_STRING;\r\n\r\n  console.log(\"DATABASE_URL:\", dbConnectionString);\r\n\r\n  if (!dbConnectionString) {\r\n    console.error(\"‚ùå Database connection string is missing.\");\r\n    return;\r\n  }\r\n\r\n  console.log(\"‚úÖ Connecting to database...\");\r\n  const database = drizzle(dbConnectionString);\r\n\r\n  console.log(\"üå± Seeding database...\");\r\n\r\n  try {\r\n    const doctorsData: NewDoctor = {\r\n      code: await generateCode(database, doctors, doctors.code, \"code\"),\r\n      name: \"Poli Kandungan\",\r\n      dayOfWeek: 6,\r\n      startTime: \"08:00:00\",\r\n      endTime: \"16:00:00\",\r\n      quota: 30,\r\n    };\r\n\r\n    const insertedDoctor = await database\r\n      .insert(doctors)\r\n      .values(doctorsData)\r\n      .returning({\r\n        id: doctors.id,\r\n        name: doctors.name,\r\n      });\r\n\r\n    console.log(\"Doctor is created:\", insertedDoctor);\r\n\r\n    if (!insertedDoctor) {\r\n      console.error(\"Error seeding doctor group:\");\r\n      return;\r\n    }\r\n\r\n    const clinicsData: NewClinic = {\r\n      code: await generateCode(database, clinics, clinics.code, \"code\"),\r\n      name: \"Poli Kandungan\",\r\n    };\r\n\r\n    const insertedClinic = await database\r\n      .insert(clinics)\r\n      .values(clinicsData)\r\n      .returning({\r\n        id: clinics.id,\r\n        name: clinics.name,\r\n      });\r\n\r\n    console.log(\"Clinic is created:\", insertedClinic);\r\n\r\n    if (!insertedClinic) {\r\n      console.error(\"Error seeding clinics group:\");\r\n      return;\r\n    }\r\n\r\n    const staffData: NewStaff = {\r\n      code: await generateCode(database, staff, staff.code, \"code\"),\r\n      loketNumber: \"01\",\r\n      username: \"admin\",\r\n      email: \"admin@dmcones.com\",\r\n      password: encryptPassword(\"admin911\"),\r\n      name: \"Holding Company\",\r\n      phone: \"08123456789\",\r\n      clinicId: insertedClinic[0].id,\r\n      address: \"Tabanan, Bali, Indonesia\",\r\n    };\r\n\r\n    const insertedStaff = await database\r\n      .insert(staff)\r\n      .values(staffData)\r\n      .returning({\r\n        id: staff.id,\r\n        name: staff.name,\r\n      });\r\n\r\n    console.log(\"Staff created:\", insertedStaff);\r\n\r\n    if (!insertedStaff) {\r\n      console.error(\"Error seeding staff:\");\r\n      return;\r\n    }\r\n\r\n    const patientsData: NewPatient = {\r\n      code: await generateCode(database, patients, patients.code, \"code\"),\r\n      registrationNumber: await generateCode(\r\n        database,\r\n        patients,\r\n        patients.registrationNumber,\r\n        \"registrationNumber\"\r\n      ),\r\n      name: \"Ryan Santoso\",\r\n      phone: \"08123456789\",\r\n      birthDate: new Date(\"2000-01-01\"),\r\n      gender: Gender.l,\r\n      nik: \"1234567890\",\r\n      patientClass: PatientClass.second,\r\n      patientType: PatientType.assurance,\r\n      address: \"Tabanan, Bali, Indonesia\",\r\n      haveAssurance: true,\r\n      assuranceCode: await generateCode(\r\n        database,\r\n        patients,\r\n        patients.assuranceCode,\r\n        \"assuranceCode\"\r\n      ),\r\n    };\r\n\r\n    const [newPatient] = await database\r\n      .insert(patients)\r\n      .values(patientsData)\r\n      .returning({\r\n        id: patients.id,\r\n        name: patients.name,\r\n      });\r\n\r\n    console.log(\"‚úÖ Patient created:\", newPatient);\r\n  } catch (error) {\r\n    console.error(\"‚ùå Error seeding patient:\", error);\r\n  }\r\n\r\n  console.log(\"üéâ Seeding Finished.\");\r\n}\r\n\r\nseedDatabase();\r\n"],"names":["seedDatabase","console","log","dbConnectionString","process","env","DB_CONNECTION_STRING","error","database","drizzle","doctorsData","code","generateCode","doctors","name","dayOfWeek","startTime","endTime","quota","insertedDoctor","insert","values","returning","id","clinicsData","clinics","insertedClinic","staffData","staff","loketNumber","username","email","password","encryptPassword","phone","clinicId","address","insertedStaff","patientsData","patients","registrationNumber","birthDate","Date","gender","Gender","l","nik","patientClass","PatientClass","second","patientType","PatientType","assurance","haveAssurance","assuranceCode","newPatient"],"mappings":"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"}