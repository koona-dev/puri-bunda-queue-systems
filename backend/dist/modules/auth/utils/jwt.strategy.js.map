{"version":3,"sources":["../../../../src/modules/auth/utils/jwt.strategy.ts"],"sourcesContent":["import { Inject, Injectable, UnauthorizedException } from \"@nestjs/common\";\nimport { ConfigService } from \"@nestjs/config\";\nimport { PassportStrategy } from \"@nestjs/passport\";\nimport { ExtractJwt, Strategy } from \"passport-jwt\";\nimport { Request } from \"express\";\nimport { AuthService } from \"../services/auth.service\";\n\n@Injectable()\nexport class JwtStrategy extends PassportStrategy(Strategy) {\n  private readonly cookieName: string;\n\n  constructor(\n    @Inject(\"AUTH_SERVICE\")\n    private readonly authService: AuthService,\n    private readonly configService: ConfigService\n  ) {\n    const secretKey = configService.get<string>(\"JWT_ACCESS_TOKEN_SECRET\");\n\n    super({\n      jwtFromRequest: ExtractJwt.fromExtractors([\n        (request: Request) => {\n          return request?.cookies?.[this.cookieName];\n        },\n      ]),\n      ignoreExpiration: false,\n      secretOrKey: secretKey!,\n    });\n\n    this.cookieName = configService.get<string>(\"ACCESS_TOKEN_COOKIE_NAME\")!;\n  }\n\n  async validate<T extends object>(payload: T) {\n    if (\"username\" in payload) {\n      return await this.authService.getByUsername((payload as any).username);\n    }\n    if (\"nik\" in payload) {\n      return await this.authService.getByNik((payload as any).nik);\n    }\n    throw new UnauthorizedException(\"Invalid payload\");\n  }\n}\n"],"names":["JwtStrategy","PassportStrategy","Strategy","validate","payload","authService","getByUsername","username","getByNik","nik","UnauthorizedException","configService","secretKey","get","jwtFromRequest","ExtractJwt","fromExtractors","request","cookies","cookieName","ignoreExpiration","secretOrKey"],"mappings":";;;;+BAQaA;;;eAAAA;;;wBAR6C;wBAC5B;0BACG;6BACI;6BAET;;;;;;;;;;;;;;;AAGrB,IAAA,AAAMA,cAAN,MAAMA,oBAAoBC,IAAAA,0BAAgB,EAACC,qBAAQ;IAuBxD,MAAMC,SAA2BC,OAAU,EAAE;QAC3C,IAAI,cAAcA,SAAS;YACzB,OAAO,MAAM,IAAI,CAACC,WAAW,CAACC,aAAa,CAAC,AAACF,QAAgBG,QAAQ;QACvE;QACA,IAAI,SAASH,SAAS;YACpB,OAAO,MAAM,IAAI,CAACC,WAAW,CAACG,QAAQ,CAAC,AAACJ,QAAgBK,GAAG;QAC7D;QACA,MAAM,IAAIC,6BAAqB,CAAC;IAClC;IA5BA,YACE,AACiBL,WAAwB,EACzC,AAAiBM,aAA4B,CAC7C;QACA,MAAMC,YAAYD,cAAcE,GAAG,CAAS;QAE5C,KAAK,CAAC;YACJC,gBAAgBC,uBAAU,CAACC,cAAc,CAAC;gBACxC,CAACC;oBACC,OAAOA,SAASC,SAAS,CAAC,IAAI,CAACC,UAAU,CAAC;gBAC5C;aACD;YACDC,kBAAkB;YAClBC,aAAaT;QACf,SAbiBP,cAAAA,kBACAM,gBAAAA;QAcjB,IAAI,CAACQ,UAAU,GAAGR,cAAcE,GAAG,CAAS;IAC9C;AAWF"}