{"version":3,"sources":["../../../src/modules/dashboard/dashboard.service.ts"],"sourcesContent":["import { NodePgDatabase } from \"drizzle-orm/node-postgres\";\r\nimport { Inject } from \"@nestjs/common\";\r\n\r\nimport { DBSchema } from \"src/database/schemas\";\r\nimport {\r\n  dashboardSummary,\r\n  hourlyQueueDistribution,\r\n  queueStatsByStaff,\r\n  staffPerformance,\r\n} from \"src/database/schemas/dashboard.view\";\r\nimport { DashboardSummary } from \"./entities/dashboard.entity\";\r\n\r\nexport class DashboardService {\r\n  constructor(@Inject(\"DB_PG\") private db: NodePgDatabase<typeof DBSchema>) {}\r\n\r\n  // ===========[Queries]===========\r\n  async getDashboardSummary(): Promise<DashboardSummary | undefined> {\r\n    try {\r\n      const queueSummary = await this.db.select().from(dashboardSummary);\r\n      const staffSummary = await this.db.select().from(queueStatsByStaff);\r\n      const topStaffPerformance = await this.db.select().from(staffPerformance);\r\n      const hourlyQueue = await this.db.select().from(hourlyQueueDistribution);\r\n\r\n      return {\r\n        queuesSummmary: queueSummary[0],\r\n        staffSummary: staffSummary,\r\n        topStaffPerformance: topStaffPerformance,\r\n        staffServiceTimeAvg: hourlyQueue,\r\n      };\r\n    } catch (error) {}\r\n  }\r\n}\r\n"],"names":["DashboardService","getDashboardSummary","queueSummary","db","select","from","dashboardSummary","staffSummary","queueStatsByStaff","topStaffPerformance","staffPerformance","hourlyQueue","hourlyQueueDistribution","queuesSummmary","staffServiceTimeAvg","error"],"mappings":";;;;+BAYaA;;;eAAAA;;;8BAZkB;wBACR;+BAQhB;;;;;;;;;;;;;;;AAGA,IAAA,AAAMA,mBAAN,MAAMA;IAGX,kCAAkC;IAClC,MAAMC,sBAA6D;QACjE,IAAI;YACF,MAAMC,eAAe,MAAM,IAAI,CAACC,EAAE,CAACC,MAAM,GAAGC,IAAI,CAACC,+BAAgB;YACjE,MAAMC,eAAe,MAAM,IAAI,CAACJ,EAAE,CAACC,MAAM,GAAGC,IAAI,CAACG,gCAAiB;YAClE,MAAMC,sBAAsB,MAAM,IAAI,CAACN,EAAE,CAACC,MAAM,GAAGC,IAAI,CAACK,+BAAgB;YACxE,MAAMC,cAAc,MAAM,IAAI,CAACR,EAAE,CAACC,MAAM,GAAGC,IAAI,CAACO,sCAAuB;YAEvE,OAAO;gBACLC,gBAAgBX,YAAY,CAAC,EAAE;gBAC/BK,cAAcA;gBACdE,qBAAqBA;gBACrBK,qBAAqBH;YACvB;QACF,EAAE,OAAOI,OAAO,CAAC;IACnB;IAjBA,YAAY,AAAyBZ,EAAmC,CAAE;aAArCA,KAAAA;IAAsC;AAkB7E"}