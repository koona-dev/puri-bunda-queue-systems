{"version":3,"sources":["../../../../src/modules/master/services/clinics.service.ts"],"sourcesContent":["import { Inject } from \"@nestjs/common\";\r\nimport { eq, SQL } from \"drizzle-orm\";\r\nimport { NodePgDatabase } from \"drizzle-orm/node-postgres\";\r\n\r\nimport { DBSchemaType } from \"src/database/schemas\";\r\nimport { clinics } from \"src/database/schemas/master.schema\";\r\nimport { generateCode } from \"src/utils/generate-code\";\r\nimport {\r\n  Clinics,\r\n  ClinicsProps,\r\n  CreateClinic,\r\n  UpdateClinic,\r\n} from \"../entities/clinics.entity\";\r\n\r\nclass ClinicsService {\r\n  constructor(@Inject(\"DB_PG\") private db: NodePgDatabase<DBSchemaType>) {}\r\n\r\n  // ===========[Queries]===========\r\n\r\n  async findOne(query: ClinicsProps): Promise<Clinics | null> {\r\n    const clinicRecord = await this.db.query.clinics.findFirst({\r\n      where: (clinic, { eq, and }) => {\r\n        const conditions: SQL[] = [];\r\n\r\n        if (query.id) conditions.push(eq(clinic.id, query.id));\r\n        if (query.code) conditions.push(eq(clinic.code, query.code));\r\n        if (query.name) conditions.push(eq(clinic.name, query.name));\r\n        if (query.isActive)\r\n          conditions.push(eq(clinic.isActive, query.isActive));\r\n        if (query.createdAt)\r\n          conditions.push(eq(clinic.createdAt, query.createdAt));\r\n\r\n        return conditions.length > 0 ? and(...conditions) : undefined;\r\n      },\r\n    });\r\n\r\n    if (!clinicRecord) {\r\n      return null;\r\n    }\r\n\r\n    return clinicRecord;\r\n  }\r\n\r\n  async findMany(query: ClinicsProps): Promise<Clinics[]> {\r\n    const clinicList = await this.db.query.clinics.findMany({\r\n      where: (clinic, { eq, and }) => {\r\n        const conditions: SQL[] = [];\r\n\r\n        if (query.id) conditions.push(eq(clinic.id, query.id));\r\n        if (query.code) conditions.push(eq(clinic.code, query.code));\r\n        if (query.name) conditions.push(eq(clinic.name, query.name));\r\n        if (query.isActive)\r\n          conditions.push(eq(clinic.isActive, query.isActive));\r\n        if (query.createdAt)\r\n          conditions.push(eq(clinic.createdAt, query.createdAt));\r\n\r\n        return conditions.length > 0 ? and(...conditions) : undefined;\r\n      },\r\n    });\r\n\r\n    return clinicList;\r\n  }\r\n\r\n  // ===========[Commands]===========\r\n  async create(data: CreateClinic): Promise<Clinics | undefined> {\r\n    try {\r\n      const clinicData: Clinics = {\r\n        ...data,\r\n        code: await generateCode(this.db, clinics, \"code\", \"CLC\"),\r\n        isActive: true,\r\n      };\r\n\r\n      const clinicRecord = await this.db\r\n        .insert(clinics)\r\n        .values(clinicData)\r\n        .returning();\r\n\r\n      return clinicRecord[0];\r\n    } catch (error) {}\r\n  }\r\n\r\n  async update(data: UpdateClinic): Promise<Clinics | undefined> {\r\n    try {\r\n      const clinicRecord = await this.db\r\n        .update(clinics)\r\n        .set(data)\r\n        .where(eq(clinics.id, data.id))\r\n        .returning();\r\n\r\n      return clinicRecord[0];\r\n    } catch (error) {}\r\n  }\r\n\r\n  async delete(id: string): Promise<boolean | undefined> {\r\n    try {\r\n      const clinicRecord = await this.db\r\n        .delete(clinics)\r\n        .where(eq(clinics.id, id))\r\n        .returning();\r\n\r\n      if (!clinicRecord) {\r\n        return false;\r\n      }\r\n      return true;\r\n    } catch (error) {}\r\n  }\r\n}\r\n\r\nexport default ClinicsService;\r\n"],"names":["ClinicsService","findOne","query","clinicRecord","db","clinics","findFirst","where","clinic","eq","and","conditions","id","push","code","name","isActive","createdAt","length","undefined","findMany","clinicList","create","data","clinicData","generateCode","insert","values","returning","error","update","set","delete"],"mappings":"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"}