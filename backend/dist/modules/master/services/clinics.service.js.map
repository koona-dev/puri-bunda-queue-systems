{"version":3,"sources":["../../../../src/modules/master/services/clinics.service.ts"],"sourcesContent":["import { Inject } from \"@nestjs/common\";\r\nimport { eq, SQL } from \"drizzle-orm\";\r\nimport { NodePgDatabase } from \"drizzle-orm/node-postgres\";\r\n\r\nimport { DBSchemaType } from \"src/database/schemas\";\r\nimport { clinics } from \"src/database/schemas/master.schema\";\r\nimport { generateCode } from \"src/utils/generate-code\";\r\nimport {\r\n  Clinics,\r\n  ClinicsProps,\r\n  CreateClinic,\r\n  UpdateClinic,\r\n} from \"../entities/clinics.entity\";\r\n\r\nclass ClinicsService {\r\n  constructor(@Inject(\"DB_PG\") private db: NodePgDatabase<DBSchemaType>) {}\r\n\r\n  // ===========[Queries]===========\r\n  async findById(id: string): Promise<Clinics | null> {\r\n    const clinicRecord = await this.db.query.clinics.findFirst({\r\n      where: (clinic, { eq }) => eq(clinic.id, id),\r\n    });\r\n\r\n    if (!clinicRecord) {\r\n      return null;\r\n    }\r\n\r\n    return clinicRecord;\r\n  }\r\n\r\n  async findOne(query: ClinicsProps): Promise<Clinics | null> {\r\n    const clinicRecord = await this.db.query.clinics.findFirst({\r\n      where: (clinic, { eq, and }) => {\r\n        const conditions: SQL[] = [];\r\n\r\n        if (query.id) conditions.push(eq(clinic.id, query.id));\r\n        if (query.code) conditions.push(eq(clinic.code, query.code));\r\n        if (query.name) conditions.push(eq(clinic.name, query.name));\r\n        if (query.isActive)\r\n          conditions.push(eq(clinic.isActive, query.isActive));\r\n        if (query.createdAt)\r\n          conditions.push(eq(clinic.createdAt, query.createdAt));\r\n\r\n        return conditions.length > 0 ? and(...conditions) : undefined;\r\n      },\r\n    });\r\n\r\n    if (!clinicRecord) {\r\n      return null;\r\n    }\r\n\r\n    return clinicRecord;\r\n  }\r\n\r\n  async findMany(query: ClinicsProps): Promise<Clinics[]> {\r\n    const clinicList = await this.db.query.clinics.findMany({\r\n      where: (clinic, { eq, and }) => {\r\n        const conditions: SQL[] = [];\r\n\r\n        if (query.id) conditions.push(eq(clinic.id, query.id));\r\n        if (query.code) conditions.push(eq(clinic.code, query.code));\r\n        if (query.name) conditions.push(eq(clinic.name, query.name));\r\n        if (query.isActive)\r\n          conditions.push(eq(clinic.isActive, query.isActive));\r\n        if (query.createdAt)\r\n          conditions.push(eq(clinic.createdAt, query.createdAt));\r\n\r\n        return conditions.length > 0 ? and(...conditions) : undefined;\r\n      },\r\n    });\r\n\r\n    return clinicList;\r\n  }\r\n\r\n  // ===========[Commands]===========\r\n  async create(data: CreateClinic): Promise<Clinics | undefined> {\r\n    try {\r\n      const clinicData: Clinics = {\r\n        ...data,\r\n        code: await generateCode(this.db, clinics, clinics.code, \"code\"),\r\n        isActive: true,\r\n      };\r\n\r\n      const clinicRecord = await this.db\r\n        .insert(clinics)\r\n        .values(clinicData)\r\n        .returning();\r\n\r\n      return clinicRecord[0];\r\n    } catch (error) {}\r\n  }\r\n\r\n  async update(data: UpdateClinic): Promise<Clinics | undefined> {\r\n    try {\r\n      const clinicRecord = await this.db\r\n        .update(clinics)\r\n        .set(data)\r\n        .where(eq(clinics.id, data.id))\r\n        .returning();\r\n\r\n      return clinicRecord[0];\r\n    } catch (error) {}\r\n  }\r\n\r\n  async delete(id: string): Promise<boolean | undefined> {\r\n    try {\r\n      const clinicRecord = await this.db\r\n        .delete(clinics)\r\n        .where(eq(clinics.id, id))\r\n        .returning();\r\n\r\n      if (!clinicRecord) {\r\n        return false;\r\n      }\r\n      return true;\r\n    } catch (error) {}\r\n  }\r\n}\r\n\r\nexport default ClinicsService;\r\n"],"names":["ClinicsService","findById","id","clinicRecord","db","query","clinics","findFirst","where","clinic","eq","findOne","and","conditions","push","code","name","isActive","createdAt","length","undefined","findMany","clinicList","create","data","clinicData","generateCode","insert","values","returning","error","update","set","delete"],"mappings":"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"}