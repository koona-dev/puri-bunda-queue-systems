{"version":3,"sources":["../../../../src/modules/master/services/doctors.service.ts"],"sourcesContent":["import { Inject } from \"@nestjs/common\";\r\nimport { eq, SQL } from \"drizzle-orm\";\r\nimport { NodePgDatabase } from \"drizzle-orm/node-postgres\";\r\n\r\nimport { DBSchemaType } from \"src/database/schemas\";\r\nimport { doctors } from \"src/database/schemas/master.schema\";\r\nimport { generateCode } from \"src/utils/generate-code\";\r\nimport {\r\n  CreateDoctor,\r\n  Doctors,\r\n  DoctorsProps,\r\n  UpdateDoctor,\r\n} from \"../entities/doctors.entity\";\r\n\r\nclass DoctorsService {\r\n  constructor(@Inject(\"DB_PG\") private db: NodePgDatabase<DBSchemaType>) {}\r\n\r\n  // ===========[Queries]===========\r\n\r\n  async findOne(query: DoctorsProps): Promise<Doctors | null> {\r\n    const doctorRecord = await this.db.query.doctors.findFirst({\r\n      where: (doctor, { eq, and }) => {\r\n        const conditions: SQL[] = [];\r\n\r\n        if (query.id) conditions.push(eq(doctor.id, query.id));\r\n        if (query.code) conditions.push(eq(doctor.code, query.code));\r\n        if (query.name) conditions.push(eq(doctor.name, query.name));\r\n        if (query.specialization)\r\n          conditions.push(eq(doctor.specialization, query.specialization));\r\n        if (query.isActive)\r\n          conditions.push(eq(doctor.isActive, query.isActive));\r\n        if (query.createdAt)\r\n          conditions.push(eq(doctor.createdAt, query.createdAt));\r\n\r\n        return conditions.length > 0 ? and(...conditions) : undefined;\r\n      },\r\n    });\r\n\r\n    if (!doctorRecord) {\r\n      return null;\r\n    }\r\n\r\n    return doctorRecord;\r\n  }\r\n\r\n  async findMany(query: DoctorsProps): Promise<Doctors[]> {\r\n    const doctorList = await this.db.query.doctors.findMany({\r\n      where: (doctor, { eq, and }) => {\r\n        const conditions: SQL[] = [];\r\n\r\n        if (query.id) conditions.push(eq(doctor.id, query.id));\r\n        if (query.code) conditions.push(eq(doctor.code, query.code));\r\n        if (query.name) conditions.push(eq(doctor.name, query.name));\r\n        if (query.specialization)\r\n          conditions.push(eq(doctor.specialization, query.specialization));\r\n        if (query.isActive)\r\n          conditions.push(eq(doctor.isActive, query.isActive));\r\n        if (query.createdAt)\r\n          conditions.push(eq(doctor.createdAt, query.createdAt));\r\n\r\n        return conditions.length > 0 ? and(...conditions) : undefined;\r\n      },\r\n    });\r\n\r\n    return doctorList;\r\n  }\r\n\r\n  // ===========[Commands]===========\r\n  async create(data: CreateDoctor): Promise<Doctors | undefined> {\r\n    try {\r\n      const doctorData: Doctors = {\r\n        ...data,\r\n        code: await generateCode(this.db, doctors, \"code\", \"DTR\"),\r\n        isActive: true,\r\n      };\r\n\r\n      const doctorRecord = await this.db\r\n        .insert(doctors)\r\n        .values(doctorData)\r\n        .returning();\r\n\r\n      return doctorRecord[0];\r\n    } catch (error) {}\r\n  }\r\n\r\n  async update(data: UpdateDoctor): Promise<Doctors | undefined> {\r\n    try {\r\n      const doctorRecord = await this.db\r\n        .update(doctors)\r\n        .set(data)\r\n        .where(eq(doctors.id, data.id))\r\n        .returning();\r\n\r\n      return doctorRecord[0];\r\n    } catch (error) {}\r\n  }\r\n\r\n  async delete(id: string): Promise<boolean | undefined> {\r\n    try {\r\n      const doctorRecord = await this.db\r\n        .delete(doctors)\r\n        .where(eq(doctors.id, id))\r\n        .returning();\r\n\r\n      if (!doctorRecord) {\r\n        return false;\r\n      }\r\n      return true;\r\n    } catch (error) {}\r\n  }\r\n}\r\n\r\nexport default DoctorsService;\r\n"],"names":["DoctorsService","findOne","query","doctorRecord","db","doctors","findFirst","where","doctor","eq","and","conditions","id","push","code","name","specialization","isActive","createdAt","length","undefined","findMany","doctorList","create","data","doctorData","generateCode","insert","values","returning","error","update","set","delete"],"mappings":"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"}