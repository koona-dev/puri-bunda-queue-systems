{"version":3,"sources":["../../../../src/modules/master/services/doctors.service.ts"],"sourcesContent":["import { Inject } from \"@nestjs/common\";\r\nimport { eq, SQL } from \"drizzle-orm\";\r\nimport { NodePgDatabase } from \"drizzle-orm/node-postgres\";\r\n\r\nimport { DBSchemaType } from \"src/database/schemas\";\r\nimport { doctors } from \"src/database/schemas/master.schema\";\r\nimport { generateCode } from \"src/utils/generate-code\";\r\nimport {\r\n  CreateDoctor,\r\n  Doctors,\r\n  DoctorsProps,\r\n  UpdateDoctor,\r\n} from \"../entities/doctors.entity\";\r\n\r\nclass DoctorsService {\r\n  constructor(@Inject(\"DB_PG\") private db: NodePgDatabase<DBSchemaType>) {}\r\n\r\n  // ===========[Queries]===========\r\n  async findById(id: string): Promise<Doctors | null> {\r\n    const doctorRecord = await this.db.query.doctors.findFirst({\r\n      where: (doctor, { eq }) => eq(doctor.id, id),\r\n    });\r\n\r\n    if (!doctorRecord) {\r\n      return null;\r\n    }\r\n\r\n    return doctorRecord;\r\n  }\r\n\r\n  async findOne(query: DoctorsProps): Promise<Doctors | null> {\r\n    const doctorRecord = await this.db.query.doctors.findFirst({\r\n      where: (doctor, { eq, and }) => {\r\n        const conditions: SQL[] = [];\r\n\r\n        if (query.id) conditions.push(eq(doctor.id, query.id));\r\n        if (query.code) conditions.push(eq(doctor.code, query.code));\r\n        if (query.name) conditions.push(eq(doctor.name, query.name));\r\n        if (query.specialization)\r\n          conditions.push(eq(doctor.specialization, query.specialization));\r\n        if (query.isActive)\r\n          conditions.push(eq(doctor.isActive, query.isActive));\r\n        if (query.createdAt)\r\n          conditions.push(eq(doctor.createdAt, query.createdAt));\r\n\r\n        return conditions.length > 0 ? and(...conditions) : undefined;\r\n      },\r\n    });\r\n\r\n    if (!doctorRecord) {\r\n      return null;\r\n    }\r\n\r\n    return doctorRecord;\r\n  }\r\n\r\n  async findMany(query: DoctorsProps): Promise<Doctors[]> {\r\n    const doctorList = await this.db.query.doctors.findMany({\r\n      where: (doctor, { eq, and }) => {\r\n        const conditions: SQL[] = [];\r\n\r\n        if (query.id) conditions.push(eq(doctor.id, query.id));\r\n        if (query.code) conditions.push(eq(doctor.code, query.code));\r\n        if (query.name) conditions.push(eq(doctor.name, query.name));\r\n        if (query.specialization)\r\n          conditions.push(eq(doctor.specialization, query.specialization));\r\n        if (query.isActive)\r\n          conditions.push(eq(doctor.isActive, query.isActive));\r\n        if (query.createdAt)\r\n          conditions.push(eq(doctor.createdAt, query.createdAt));\r\n\r\n        return conditions.length > 0 ? and(...conditions) : undefined;\r\n      },\r\n    });\r\n\r\n    return doctorList;\r\n  }\r\n\r\n  // ===========[Commands]===========\r\n  async create(data: CreateDoctor): Promise<Doctors | undefined> {\r\n    try {\r\n      const doctorData: Doctors = {\r\n        ...data,\r\n        code: await generateCode(this.db, doctors, doctors.code, \"code\"),\r\n        isActive: true,\r\n      };\r\n\r\n      const doctorRecord = await this.db\r\n        .insert(doctors)\r\n        .values(doctorData)\r\n        .returning();\r\n\r\n      return doctorRecord[0];\r\n    } catch (error) {}\r\n  }\r\n\r\n  async update(data: UpdateDoctor): Promise<Doctors | undefined> {\r\n    try {\r\n      const doctorRecord = await this.db\r\n        .update(doctors)\r\n        .set(data)\r\n        .where(eq(doctors.id, data.id))\r\n        .returning();\r\n\r\n      return doctorRecord[0];\r\n    } catch (error) {}\r\n  }\r\n\r\n  async delete(id: string): Promise<boolean | undefined> {\r\n    try {\r\n      const doctorRecord = await this.db\r\n        .delete(doctors)\r\n        .where(eq(doctors.id, id))\r\n        .returning();\r\n\r\n      if (!doctorRecord) {\r\n        return false;\r\n      }\r\n      return true;\r\n    } catch (error) {}\r\n  }\r\n}\r\n\r\nexport default DoctorsService;\r\n"],"names":["DoctorsService","findById","id","doctorRecord","db","query","doctors","findFirst","where","doctor","eq","findOne","and","conditions","push","code","name","specialization","isActive","createdAt","length","undefined","findMany","doctorList","create","data","doctorData","generateCode","insert","values","returning","error","update","set","delete"],"mappings":"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"}