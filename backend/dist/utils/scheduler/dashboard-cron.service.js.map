{"version":3,"sources":["../../../src/utils/scheduler/dashboard-cron.service.ts"],"sourcesContent":["import { Inject, Injectable, Logger } from \"@nestjs/common\";\nimport { Cron, CronExpression } from \"@nestjs/schedule\";\nimport { NodePgDatabase } from \"drizzle-orm/node-postgres\";\n\nimport { DBSchema } from \"src/database/schemas\";\nimport {\n  dashboardSummary,\n  hourlyQueueDistribution,\n  queueStatsByStaff,\n  staffPerformance,\n} from \"src/database/schemas/dashboard.view\";\n\n@Injectable()\nexport class DashboardCronService {\n  private readonly logger = new Logger(DashboardCronService.name);\n\n  constructor(@Inject(\"DB_PG\") private db: NodePgDatabase<typeof DBSchema>) {}\n\n  @Cron(CronExpression.EVERY_30_MINUTES)\n  async generateDashboardGraphCron() {\n    await this.db.refreshMaterializedView(dashboardSummary);\n    await this.db.refreshMaterializedView(queueStatsByStaff);\n    await this.db.refreshMaterializedView(staffPerformance);\n    await this.db.refreshMaterializedView(hourlyQueueDistribution);\n  }\n}\n"],"names":["DashboardCronService","generateDashboardGraphCron","db","refreshMaterializedView","dashboardSummary","queueStatsByStaff","staffPerformance","hourlyQueueDistribution","logger","Logger","name","EVERY_30_MINUTES"],"mappings":";;;;+BAaaA;;;eAAAA;;;wBAb8B;0BACN;8BACN;+BAQxB;;;;;;;;;;;;;;;AAGA,IAAA,AAAMA,uBAAN,MAAMA;IAKX,MACMC,6BAA6B;QACjC,MAAM,IAAI,CAACC,EAAE,CAACC,uBAAuB,CAACC,+BAAgB;QACtD,MAAM,IAAI,CAACF,EAAE,CAACC,uBAAuB,CAACE,gCAAiB;QACvD,MAAM,IAAI,CAACH,EAAE,CAACC,uBAAuB,CAACG,+BAAgB;QACtD,MAAM,IAAI,CAACJ,EAAE,CAACC,uBAAuB,CAACI,sCAAuB;IAC/D;IARA,YAAY,AAAyBL,EAAmC,CAAE;aAArCA,KAAAA;aAFpBM,SAAS,IAAIC,cAAM,CAACT,qBAAqBU,IAAI;IAEa;AAS7E;;iDAPuBC"}